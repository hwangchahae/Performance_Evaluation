<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Evaluation Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-height: 70vh;
            overflow-y: auto;
        }

        .content-area {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-height: 70vh;
            overflow-y: auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 16px;
            transition: all 0.3s;
            position: relative;
        }

        .tab.active {
            color: #667eea;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .model-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .model-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .model-btn.active {
            background: #667eea;
            color: white;
        }

        .file-list {
            list-style: none;
        }

        .file-item {
            padding: 10px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            word-break: break-all;
        }

        .file-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .file-item.active {
            background: #667eea;
            color: white;
        }

        .json-viewer {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 20px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 500px;
            overflow-y: auto;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .comparison-card {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
        }

        .comparison-card h4 {
            color: #333;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .success {
            background: #51cf66;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .performance-table th,
        .performance-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .performance-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .performance-table tr:hover {
            background: #f8f9fa;
        }

        .improvement-positive {
            color: #51cf66;
            font-weight: bold;
        }

        .improvement-negative {
            color: #ff6b6b;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ”¬ Performance Evaluation Dashboard</h1>
            <p>Compare Pre-Training, Post-Training, and Gold Standard Data</p>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3>Gold Standard Files</h3>
                <div class="value" id="goldCount">-</div>
            </div>
            <div class="stat-card">
                <h3>Pre-Training (1.7B)</h3>
                <div class="value" id="pre17Count">-</div>
            </div>
            <div class="stat-card">
                <h3>Pre-Training (4B)</h3>
                <div class="value" id="pre4Count">-</div>
            </div>
            <div class="stat-card">
                <h3>Pre-Training (8B)</h3>
                <div class="value" id="pre8Count">-</div>
            </div>
            <div class="stat-card">
                <h3>Post-Training (1.7B)</h3>
                <div class="value" id="post17Count">-</div>
            </div>
            <div class="stat-card">
                <h3>Post-Training (4B)</h3>
                <div class="value" id="post4Count">-</div>
            </div>
            <div class="stat-card">
                <h3>Post-Training (8B)</h3>
                <div class="value" id="post8Count">-</div>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <input type="text" class="search-box" id="searchBox" placeholder="Search files...">
                
                <div class="model-selector">
                    <button class="model-btn active" data-model="1.7B">1.7B</button>
                    <button class="model-btn" data-model="4B">4B</button>
                    <button class="model-btn" data-model="8B">8B</button>
                </div>

                <ul class="file-list" id="fileList">
                    <li class="loading">Loading files...</li>
                </ul>
            </div>

            <div class="content-area">
                <div class="tabs">
                    <button class="tab active" data-tab="comparison">Comparison</button>
                    <button class="tab" data-tab="gold">Gold Standard</button>
                    <button class="tab" data-tab="pre">Pre-Training</button>
                    <button class="tab" data-tab="post">Post-Training</button>
                    <button class="tab" data-tab="performance">Performance</button>
                </div>

                <div id="contentDisplay">
                    <div class="loading">Select a file from the sidebar to view data</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentModel = '1.7B';
        let currentTab = 'comparison';
        let allData = {
            goldStandard: [],
            preTraining: {},
            postTraining: {},
            performance: []
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            loadOverview();
            loadGoldStandard();
            loadModelResults(currentModel);
            loadPerformanceSummary();
            setupEventListeners();
        });

        // Load overview statistics
        async function loadOverview() {
            try {
                const response = await fetch('/api/overview');
                const data = await response.json();
                
                document.getElementById('goldCount').textContent = data.gold_standard;
                document.getElementById('pre17Count').textContent = data.pre_training['1.7B'];
                document.getElementById('pre4Count').textContent = data.pre_training['4B'];
                document.getElementById('pre8Count').textContent = data.pre_training['8B'];
                document.getElementById('post17Count').textContent = data.post_training['1.7B'];
                document.getElementById('post4Count').textContent = data.post_training['4B'];
                document.getElementById('post8Count').textContent = data.post_training['8B'];
            } catch (error) {
                console.error('Error loading overview:', error);
            }
        }

        // Load gold standard files
        async function loadGoldStandard() {
            try {
                const response = await fetch('/api/gold_standard');
                allData.goldStandard = await response.json();
            } catch (error) {
                console.error('Error loading gold standard:', error);
            }
        }

        // Load model results
        async function loadModelResults(model) {
            try {
                // Load pre-training results
                const preResponse = await fetch(`/api/results/${model}/pre`);
                allData.preTraining[model] = await preResponse.json();
                
                // Load post-training results
                const postResponse = await fetch(`/api/results/${model}/post`);
                allData.postTraining[model] = await postResponse.json();
                
                // Update file list
                updateFileList(model);
            } catch (error) {
                console.error('Error loading model results:', error);
            }
        }

        // Load performance summary
        async function loadPerformanceSummary() {
            try {
                const response = await fetch('/api/performance_summary');
                allData.performance = await response.json();
            } catch (error) {
                console.error('Error loading performance summary:', error);
            }
        }

        // Update file list in sidebar
        function updateFileList(model) {
            const fileList = document.getElementById('fileList');
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            
            // Get unique folder names from pre-training results
            const folders = allData.preTraining[model] || [];
            
            // Filter based on search
            const filteredFolders = folders.filter(item => 
                item.folder.toLowerCase().includes(searchTerm)
            );
            
            if (filteredFolders.length === 0) {
                fileList.innerHTML = '<li class="file-item">No files found</li>';
                return;
            }
            
            fileList.innerHTML = filteredFolders.map(item => 
                `<li class="file-item" data-folder="${item.folder}" data-model="${model}">${item.folder}</li>`
            ).join('');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Model selector
            document.querySelectorAll('.model-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    document.querySelectorAll('.model-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentModel = e.target.dataset.model;
                    
                    // Load data if not already loaded
                    if (!allData.preTraining[currentModel]) {
                        await loadModelResults(currentModel);
                    } else {
                        updateFileList(currentModel);
                    }
                });
            });

            // Tab selector
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    currentTab = e.target.dataset.tab;
                    
                    if (currentTab === 'performance') {
                        showPerformanceSummary();
                    }
                });
            });

            // Search box
            document.getElementById('searchBox').addEventListener('input', (e) => {
                updateFileList(currentModel);
            });

            // File list click handler
            document.getElementById('fileList').addEventListener('click', async (e) => {
                if (e.target.classList.contains('file-item')) {
                    document.querySelectorAll('.file-item').forEach(item => item.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const folder = e.target.dataset.folder;
                    const model = e.target.dataset.model;
                    
                    await loadComparison(model, folder);
                }
            });
        }

        // Load comparison data
        async function loadComparison(model, folder) {
            const contentDisplay = document.getElementById('contentDisplay');
            contentDisplay.innerHTML = '<div class="loading">Loading comparison data...</div>';
            
            try {
                const response = await fetch(`/api/compare/${model}/${folder}`);
                const data = await response.json();
                
                if (currentTab === 'comparison') {
                    showComparison(data);
                } else if (currentTab === 'gold') {
                    showGoldStandard(data.gold_standard);
                } else if (currentTab === 'pre') {
                    showPreTraining(data.pre_training);
                } else if (currentTab === 'post') {
                    showPostTraining(data.post_training);
                }
            } catch (error) {
                contentDisplay.innerHTML = `<div class="error">Error loading data: ${error.message}</div>`;
            }
        }

        // Show comparison view
        function showComparison(data) {
            const contentDisplay = document.getElementById('contentDisplay');
            
            let html = `<h2>Comparison: ${data.result_folder}</h2>`;
            html += '<div class="comparison-grid">';
            
            // Pre-training
            html += '<div class="comparison-card">';
            html += '<h4>Pre-Training (Base Model)</h4>';
            if (data.pre_training) {
                html += `<div class="json-viewer">${formatJSON(data.pre_training)}</div>`;
            } else {
                html += '<p>No pre-training data available</p>';
            }
            html += '</div>';
            
            // Post-training
            html += '<div class="comparison-card">';
            html += '<h4>Post-Training (Fine-Tuned)</h4>';
            if (data.post_training) {
                html += `<div class="json-viewer">${formatJSON(data.post_training)}</div>`;
            } else {
                html += '<p>No post-training data available</p>';
            }
            html += '</div>';
            
            // Gold standard
            html += '<div class="comparison-card">';
            html += '<h4>Gold Standard (Ground Truth)</h4>';
            if (data.gold_standard && data.gold_standard.found) {
                html += `<div class="json-viewer">${formatJSON(data.gold_standard.data)}</div>`;
            } else {
                html += '<p>No matching gold standard found</p>';
            }
            html += '</div>';
            
            html += '</div>';
            contentDisplay.innerHTML = html;
        }

        // Show gold standard view
        function showGoldStandard(data) {
            const contentDisplay = document.getElementById('contentDisplay');
            
            if (data && data.found) {
                contentDisplay.innerHTML = `
                    <h2>Gold Standard Data</h2>
                    <div class="json-viewer">${formatJSON(data.data)}</div>
                `;
            } else {
                contentDisplay.innerHTML = '<div class="error">No matching gold standard data found</div>';
            }
        }

        // Show pre-training view
        function showPreTraining(data) {
            const contentDisplay = document.getElementById('contentDisplay');
            
            if (data) {
                contentDisplay.innerHTML = `
                    <h2>Pre-Training Result</h2>
                    <div class="json-viewer">${formatJSON(data)}</div>
                `;
            } else {
                contentDisplay.innerHTML = '<div class="error">No pre-training data available</div>';
            }
        }

        // Show post-training view
        function showPostTraining(data) {
            const contentDisplay = document.getElementById('contentDisplay');
            
            if (data) {
                contentDisplay.innerHTML = `
                    <h2>Post-Training Result</h2>
                    <div class="json-viewer">${formatJSON(data)}</div>
                `;
            } else {
                contentDisplay.innerHTML = '<div class="error">No post-training data available</div>';
            }
        }

        // Show performance summary
        function showPerformanceSummary() {
            const contentDisplay = document.getElementById('contentDisplay');
            
            if (allData.performance.length === 0) {
                contentDisplay.innerHTML = '<div class="error">No performance summary available</div>';
                return;
            }
            
            let html = '<h2>Performance Summary</h2>';
            html += '<table class="performance-table">';
            html += '<thead><tr>';
            html += '<th>Model</th>';
            html += '<th>TF-IDF Pre</th>';
            html += '<th>TF-IDF Post</th>';
            html += '<th>TF-IDF Improvement</th>';
            html += '<th>Embedding Pre</th>';
            html += '<th>Embedding Post</th>';
            html += '<th>Embedding Improvement</th>';
            html += '</tr></thead>';
            html += '<tbody>';
            
            allData.performance.forEach(row => {
                const tfidfClass = row['TF-IDF_Improvement_%'] > 0 ? 'improvement-positive' : 'improvement-negative';
                const embClass = row['Embedding_Improvement_%'] > 0 ? 'improvement-positive' : 'improvement-negative';
                
                html += '<tr>';
                html += `<td><strong>${row.Model}</strong></td>`;
                html += `<td>${parseFloat(row.TF-IDF_Pre).toFixed(4)}</td>`;
                html += `<td>${parseFloat(row.TF-IDF_Post).toFixed(4)}</td>`;
                html += `<td class="${tfidfClass}">${parseFloat(row['TF-IDF_Improvement_%']).toFixed(2)}%</td>`;
                html += `<td>${parseFloat(row.Embedding_Pre).toFixed(4)}</td>`;
                html += `<td>${parseFloat(row.Embedding_Post).toFixed(4)}</td>`;
                html += `<td class="${embClass}">${parseFloat(row['Embedding_Improvement_%']).toFixed(2)}%</td>`;
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            contentDisplay.innerHTML = html;
        }

        // Format JSON for display
        function formatJSON(obj) {
            return `<pre>${JSON.stringify(obj, null, 2)}</pre>`;
        }
    </script>
</body>
</html>